<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>学习资源管理</title>
	<meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no">
	<meta name="format-detection" content="telephone=no">  <!-- 不识别数字为电话 -->
	<link rel="shortcut icon" type="image/x-icon" href="./icons/resMgmt.png" media="screen" />
	<link rel='bookmark' href='./icons/resMgmt.png'> 
	<link rel="stylesheet" type="text/css" href="./styles/reset.css">
	<link rel="stylesheet" type="text/css" href="./styles/global.css">
	<link rel="stylesheet" type="text/css" href="./styles/lx-sidebar.css">
	<link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.10.16/css/jquery.dataTables.min.css">
  	<link rel="stylesheet" type="text/css" href="https://cdn.bootcss.com/bootstrap/4.0.0-beta.2/css/bootstrap.min.css">
</head>
<body>
	<img class="toTop" src="./icons/rocket1.png" alt="toTop">
	<div id="container" class="">
		<div class="l-sidebar">
			<div class="l-sidebar-main">
				<div class="lx-sidebar-top cl">
					<img class="lx-sidebar-narrow" src="./icons/catalog.png" alt="catalog">
				</div>
				<div class="l-sidebar-summary">
					<h3>学习资源管理</h3>
					<p>将前端开发的资源文件规整在一起，方便查找学习</p>
				</div>
				
				<div class="l-sidebar-menu">
					<span class="l-sidebar-menu-title">菜单</span>
					<div class="l-sidebar-menu-main">
						<div class="lx-sidebar">
							<ul class="lx-sidebar-ul">
								<!-- <li class="lx-sidebar-li">
									<a href="javascript:;">111</a>
									<img class="lx-sidebar-arrow" src="./icons/arrow.png">
									<ul class="lx-sidebar-show">
										<li><a href="javascript:;">111</a></li>
										<li><a href="javascript:;">111</a></li>
										<li><a href="javascript:;">111</a></li>
									</ul>
								</li> -->
							</ul>
						</div>
					</div>
				</div>
			</div>
		</div>
		
		<div class="main">
			<div class="top-nav">
				<a href="https://github.com/shawn-li">
					<div class="top-nav-item">
						<img src="./icons/github.png" alt="github">
						<span>github</span>
					</div>
				</a>
				
			</div>

			<table id="example" class="display">
			<div id="buttonBox" style="padding: 10px;"></div>
				<thead>
				<tr>
				  <th><input type="checkbox" id="CheckAll"></th>
				  <th>网址</th>
				  <th>链接</th>
				  <th>种类</th>
				</tr>
				</thead>
				<tbody>

				</tbody>
			</table>
			<!-- <div class="content-container">
				<div class="loader loader-hobby">
					<div class="loader-item loader1"></div>
					<div class="loader-item loader2"></div>
					<div class="loader-item loader3"></div>
				</div>
			</div> -->
		</div>
		<div class="copyright">
			Copyright©2017 shawn-li
		</div>
	</div>


	<script type="text/javascript" src="https://cdn.bootcss.com/jquery/3.2.1/jquery.min.js"></script>
	<script type="text/javascript" src="./js/lxSidebar.min.js"></script>
	<script type="text/javascript" src="https://cdn.bootcss.com/bootstrap/4.0.0-beta.2/css/bootstrap.css"></script>
	<script type="text/javascript" language="javascript" src="https://cdn.datatables.net/1.10.16/js/jquery.dataTables.min.js"></script>
	<script type="text/javascript">
		(function($){

			var BUTTONS =
            '<button class="btn btn-default"  type="button" id="reload" data-toggle="modal" data-target="#employeeModal">刷新表格</button>' +
            '<button class="btn btn-primary" type="button" id="batchIds" style="margin-left:20px;" data-toggle="modal" >多选</button>' +
            '<button class="btn btn-primary" type="button" id="selection" style="margin-left:20px;" data-toggle="modal" >单选</button>';

            //选中一行 checkbox选中
		    function checkbox(tableId) {
		        //每次加载时都先清理
		        $('#' + tableId + ' tbody').off("click", "tr");
		        $('#' + tableId + ' tbody').on("click", "tr", function () {
		            $(this).toggleClass('selected');
		            if ($(this).hasClass("selected")) {
		                $(this).find("input").prop("checked", true);
		            } else {
		                $(this).find("input").prop("checked", false);
		            }
		        });
		    }

		    //获取所有选中行的UUID 多选
		    function batchIds() {
		        var uuid = '';
		        var uuids = lxTable.rows(".selected").data();
		        if (uuids.length == 0) {
		            alert("请选择一条数据！");
		        } else {
		            for (var i = 0; i < uuids.length; i++) {
		                uuid = uuid + uuids[i].url + ",";
		            }
		            alert(uuid);
		        }
		    }

		    //单选
		    function selection() {

		        if (lxTable.rows(".selected").data().length == 1) {
		            var uuid = lxTable.row(".selected").data().url;

		            if (uuid == "") {
		                alert("请选择一条数据！");
		            } else {
		                alert(uuid);
		            }

		        } else {
		            alert("请选择一条数据！");
		        }
		    }

		    //刷新页面
		    //重新加载数据
		    function reload() {
		        lxTable.ajax.reload();
		    }

			var lxSidebarJson = function(){
				
				$.ajaxSetup({  
				    async : false  
				});  
				$.get('./json/catalog.json', function(data){
					var _data = data.catalog;

					create(_data);
					console.log('sidebar data loaded!');
				});
			}
			//创建sidebar
			var create = function(_data){
				for (var i = 0; i < _data.length; i++) {
					var type = _data[i].type 
					var arr_obj = [];
					var children = _data[i].children;
					
					if (children) {
						var len = children.length;
						for (var j=0; j<len;j++) {
							//console.log(children[j].type);
							arr_obj.push(children[j]);
						}
					}
					//console.log(arr);
					createLi(document.querySelector('.lx-sidebar-ul'),type,arr_obj);
				}
			}
			//创建sidebar
			var createLi = function(parent ,text, children){
				var liDom = document.createElement('li');
				liDom.className = 'lx-sidebar-li';
				var aDom = document.createElement('a');
				var aTextNode = document.createTextNode(text);
				aDom.className = "js-lx-sidebar-item";
				aDom.appendChild(aTextNode);
				aDom.setAttribute('href','javascript:;');
				var imgDom = document.createElement('img');
				imgDom.className = 'lx-sidebar-arrow js-lx-sidebar-item';
				imgDom.setAttribute('src','./icons/arrow.png');
				var ulDom = document.createElement('ul');
				ulDom.className = 'lx-sidebar-show';
				for (var i = 0; i < children.length; i++) {
					var subliDom = document.createElement('li');
					subliDom.className = 'lx-sidebar-sub-li'
					var subaDom = document.createElement('a');
					subaDom.className = 'js-lx-sidebar-subItem';
					subaDom.setAttribute('href','javascript:;');
					subaDom.setAttribute('data-file',children[i].name);
					subaDom.setAttribute('data-type',children[i].type);
					var aTextNode = document.createTextNode(children[i].type);
					subaDom.appendChild(aTextNode);
					subliDom.appendChild(subaDom);
					ulDom.appendChild(subliDom);
				}

				parent.appendChild(liDom);
				liDom.appendChild(aDom);
				liDom.appendChild(imgDom);
				liDom.appendChild(ulDom);
			}

			lxSidebarJson();

			$('.lx-sidebar').lxSidebar();

			var lxTable = $('#example').DataTable({
				"searching": true,//搜索框，默认是开启

				"lengthChange": true,//是否允许用户改变表格每页显示的记录数，默认是开启

				"paging": true,//是否开启本地分页，默认是开启

				"ordering":  true, //默认排序

				"processing": true,//是否显示中文提示

				"scrollCollapse": true,  //是否开启DataTables的高度自适应，当数据条数不够分页数据条数的时候，插件高度是否随数据条数而改变

				"serverSide": false, //开启服务器模式，默认是关闭

				"scrollY": "100%",//设置高

				"scrollX": "100%",//设置宽度

				"scrollXInner": "100%",//设置内宽度

				"jQueryUI": false,//jquery 风格

				"autoWidth": true, //是否自适应宽度

				"dom": '<lf<t>ip>',

				"language": {
					"sProcessing": "处理中...",
					"sLengthMenu": "显示 _MENU_ 项结果",
					"sZeroRecords": "没有匹配结果",
					"sInfo": "显示第 _START_ 至 _END_ 项结果，共 _TOTAL_ 项",
					"sInfoEmpty": "显示第 0 至 0 项结果，共 0 项",
					"sInfoFiltered": "(由 _MAX_ 项结果过滤)",
					"sInfoPostFix": "",
					"sSearch": "搜索:",
					"sUrl": "",
					"sEmptyTable": "未搜索到数据",
					"sLoadingRecords": "载入中...",
					"sInfoThousands": ",",
					"oPaginate": {
					  "sFirst": "首页",
					  "sPrevious": "上页",
					  "sNext": "下页",
					  "sLast": "末页"
					},
					"oAria": {
					  "sSortAscending": ": 以升序排列此列",
					  "sSortDescending": ": 以降序排列此列"
					}
				},

				"initComplete": function () {

	            	$("#buttonBox").append(BUTTONS);
	                if (1) {
	                    $search = $("input[type='search']");
	                    //隐藏默认的搜索框
	                    //$search.parent().hide();
	                }
	                //加载完成之后 初始化checkbox

	                checkbox('example');


	                $("#reload").click(function () {
	                    reload();
	                });

	                $("#batchIds").click(function () {
	                    batchIds();
	                });

	                $("#selection").click(function () {
	                    selection();
	                });

	                //checkbox全选
	                $("#CheckAll").click(function () {
	                    if ($(this).prop("checked")) {
	                        $("input[name='checkList']").prop("checked", true);
	                        $("tr").addClass('selected');
	                    } else {
	                        $("input[name='checkList']").prop("checked", false);
	                        $("tr").removeClass('selected');
	                    }
	                });
		        },

				ajax: {
		            url: './json/system.json',
		            //url: url,
		            dataSrc:'data'
		          },
		          //ajax:"./json/test.json",

				"columns": [
					{
						"data": "type",
						"createdCell": function (nTd, sData) {
							$(nTd).html("<input type='checkbox' name='checkList' value='" + sData + "'>");
						}
					},
					{ "data": "title" },
					{ "data": "url" },
					{ "data": "type" }
				]
			});

			var loadData = function(url){
				if (!lxTable) {
					console.log('dataTabel wrong!!');
				}else{
					console.log(lxTable)
					lxTable.ajax.url(url).load();
				}
				
			}

			
			var $content = $('.content-container');
			var $subItem = $('.js-lx-sidebar-subItem');

			$subItem.click(function(){
				var $this = $(this);
				var file = $this.attr('data-file');
				var type = $this.attr('data-type');
				console.log('./json/'+file+'.json')
				
				loadData('./json/'+file+'.json');
			});

			var $toTop = $('.toTop');
			var $html_body = $('body,html');
			$toTop.click(function(){
				$html_body.animate({scrollTop: 0 }, 800);
				return false;
			});
			
			
		})(jQuery)
	</script>
</body>
</html>